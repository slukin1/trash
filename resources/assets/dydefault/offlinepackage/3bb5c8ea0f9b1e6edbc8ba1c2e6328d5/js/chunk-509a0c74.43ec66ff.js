(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-509a0c74"],{1549:function(t,s,e){"use strict";var i=function(){var t=this,s=t._self._c;return s("div",{staticClass:"btn"},[t._t("default"),s("p",{staticClass:"button",class:{active:t.canClick},on:{click:t.btnClick}},[t.loading?s("span",{staticClass:"btn-loading"}):t._e(),t.loading?t._e():s("span",[t._v(t._s(t.btnTextVal))])])],2)},a=[],o=e("ca00"),c={props:{btnText:{type:String,default:""},loading:{type:Boolean,default:!1},canClick:{type:Boolean,default:!1}},data(){return{}},computed:{btnTextVal(){return this.btnText||this.$$t("{#提交#}")}},created(){},methods:{ts:o["k"],btnClick(){this.$emit("btnClick")}}},n=c,r=(e("4d1d"),e("2877")),l=Object(r["a"])(n,i,a,!1,null,"74d603cb",null);s["a"]=l.exports},"2f1c":function(t,s,e){},4550:function(t,s,e){},"4d1d":function(t,s,e){"use strict";e("a4e1")},"66e0":function(t,s,e){"use strict";var i=function(){var t=this,s=t._self._c;return s("div",{staticClass:"head"},[s("img",{attrs:{src:e("e669")},on:{click:t.goBack}})])},a=[],o=e("aa0e"),c=e.n(o),n={props:{backPage:{type:String,default:""}},methods:{goBack(){"app"===this.backPage?c()("20010006",()=>{}):window.history.go(-1)}}},r=n,l=(e("e931"),e("2877")),d=Object(l["a"])(r,i,a,!1,null,"787cb26c",null);s["a"]=d.exports},"78b0":function(t,s,e){},"8ff9":function(t,s,e){"use strict";e.d(s,"a",(function(){return a}));const{replace:i}=e("b12e"),a=t=>new Promise((function(s,e){let a=["/jpg","/png","/jpeg"],o=t.type,c=!1,n=o.substring(o.indexOf("/"));for(let t=0;t<a.length;t++)if(a[t]==n){c=!0;break}c||e(i("{#文件仅支持JPG、JPEG、PNG格式#}"));let r=t.size,l=r/1024;(l>5120||l<10)&&e(i("{#文件需大于10KB，小于5M#}"));let d=new FileReader;d.onload=function(t){let a=t.target.result,o=new Image;o.onload=function(){o.width,o.height;s()},o.onerror=function(){e(i("{#文件需大于10KB，小于5M#}"))},o.src=a},d.readAsDataURL(t)})).then(()=>t,t=>Promise.reject(t))},"9ecc":function(t,s,e){"use strict";e("78b0")},a156:function(t,s,e){"use strict";e("2f1c")},a4e1:function(t,s,e){},a5dd:function(t,s,e){"use strict";e.r(s);var i=function(){var t=this,s=t._self._c;return s("div",{staticClass:"main"},[s("Upload",{attrs:{"card-type":t.cardType,positive:!0},on:{saveFile:t.saveFile,showLoading:t.showLoading}}),"2"!==t.cardType?s("Upload",{attrs:{"card-type":t.cardType,positive:!1},on:{saveFile:t.saveFile,showLoading:t.showLoading}}):t._e(),s("Example"),s("Btn",{attrs:{"can-click":t.canSubmit&&!t.authIng,loading:t.canSubmit&&t.authIng},on:{btnClick:t.goVerificate}})],1)},a=[],o=e("aa0e"),c=e.n(o),n=e("5c96"),r=e("66e0"),l=function(){var t=this,s=t._self._c;return s("section",{staticClass:"example"},[s("ul",{staticClass:"example-img"},[s("li",[s("div",{staticClass:"img success"}),s("div",{staticClass:"text"},[t._v(t._s(t.$$t("{#标准#}")))])]),s("li",[s("div",{staticClass:"img err1"}),s("div",{staticClass:"text"},[t._v(t._s(t.$$t("{#证件缺失#}")))])]),s("li",[s("div",{staticClass:"img err2"}),s("div",{staticClass:"text"},[t._v(t._s(t.$$t("{#证件模糊#}")))])]),s("li",[s("div",{staticClass:"img err3"}),s("div",{staticClass:"text"},[t._v(t._s(t.$$t("{#有反光#}")))])])]),s("ul",{staticClass:"example-content"},[s("li",[t._v("1."+t._s(t.$$t("{#请使用政府发行的原始证件#}")))]),s("li",[t._v("2."+t._s(t.$$t("{#在单色背景下放置证件#}")))]),s("li",[t._v("3."+t._s(t.$$t("{#拍摄的证件清晰、无遮挡、无反光#}")))]),s("li",[t._v("4."+t._s(t.$$t("{#请勿使用黑白图像#}")))])])])},d=[],p={props:{}},u=p,h=(e("9ecc"),e("2877")),g=Object(h["a"])(u,l,d,!1,null,"43d2f8e1",null),_=g.exports,f=function(){var t=this,s=t._self._c;return s("div",{staticClass:"upload-container"},[t.imgSrc?t._e():s("div",{staticClass:"upload-item"},[t.isLoading?t._e():s("div",[s("div",{staticClass:"photo-logo"}),s("div",{staticClass:"title"},[t._v(" "+t._s(t.cardName[t.cardType])+t._s(t.isSpace?" ":"")+" "+t._s(t.positive?t.$$t("{#人像照片页#}"):t.$$t("{#背面照#}"))+" ")]),s("div",{staticClass:"content"},[t._v(t._s(t.$$t("{#支持JPG、JPEG、PNG格式；文件需大于10KB，小于5M#}")))])]),t.isLoading?s("div",[s("div",{staticClass:"loading-logo"}),s("div",{staticClass:"loading-text"},[t._v(t._s(t.$$t("{#正在上传#}"))+"...")])]):t._e(),t.isCamera&&!t.useApp?s("input",{ref:"fileBtn",attrs:{type:"file",accept:".png,.jpg,.jpeg"},on:{change:t.uploadImg}}):t._e(),!t.isCamera||t.useApp?s("p",{on:{click:t.select}}):t._e()]),t.imgSrc?s("div",{staticClass:"img-item"},[s("img",{staticClass:"common",attrs:{src:t.imgSrc}}),s("div",{staticClass:"img-item-cover"},[t.imgSrc&&!t.isLoading?s("div",[s("div",{staticClass:"photo-logo"}),s("div",{staticClass:"title"},[t._v(t._s(t.$$t("{#上传成功，点击修改#}")))])]):t._e(),t.imgSrc&&t.isLoading?s("div",{staticClass:"re-upload"},[s("div",{staticClass:"loading-logo"}),s("div",{staticClass:"loading-text"},[t._v(t._s(t.$$t("{#正在上传#}"))+"...")])]):t._e()]),t.isCamera&&!t.useApp?s("input",{ref:"fileBtn",attrs:{type:"file",accept:".png,.jpg,.jpeg"},on:{change:t.uploadImg}}):t._e(),!t.isCamera||t.useApp?s("p",{on:{click:t.select}}):t._e()]):t._e()])},m=[],v=e("f3e4"),k=e("8ff9"),A=e("7c15"),C=e("b893"),w=e("ca00"),y={components:{},props:{cardType:{type:[String,Number],default:""},positive:{type:Boolean,default:!1}},data(){return{isShow:!0,imgSrc:"",file:{},fileExtensionName:"",isLoading:!1,cardName:{1:this.$$t("{#身份证#}"),2:this.$$t("{#护照#}"),3:this.$$t("{#驾照#}"),4:this.$$t("{#多米尼克数字ID#}")},isCamera:!0,isSpace:!1,useApp:!1}},async created(){const{appVersion:t}=await Object(w["f"])();t&&t>=675?this.useApp=!0:this.checkPermission(),this.isSpace=!("zh-cn"===v["a"].get("lang")||"zh-hk"===v["a"].get("lang"))},methods:{uploadImg(t){const s=this,{target:{files:[e]}}=t;if(!e)return;const i=this.positive?s.imgSrc?"h5_kyc_self_re_positive_click":"h5_kyc_self_positive_click":s.imgSrc?"h5_kyc_self_re_obverse_click":"h5_kyc_self_obverse_click";window.sensors.track(i),this.uploadPic(e)},showToast(t){const s=this;n["Message"].error({duration:2e3,offset:52,customClass:"is-error",message:t,onClose(){s.showLoading(!0)}})},showLoading(t){this.isLoading=!t,this.$emit("showLoading",t)},select(){const t=this;if(this.useApp){const s=this.positive?t.imgSrc?"h5_kyc_self_re_positive_click":"h5_kyc_self_positive_click":t.imgSrc?"h5_kyc_self_re_obverse_click":"h5_kyc_self_obverse_click";window.sensors.track(s),c()("20010080",{supportCamera:1,supportAlbum:1},({data:s})=>{if(s){if(s.picture)try{const t=Object(w["e"])(s.picture);this.uploadPic(t)}catch(e){t.showToast(t.$$t("{#文件需大于10KB，小于5M#}")),t.report("base64转换成文件流出问题")}}else t.showToast(t.$$t("{#文件需大于10KB，小于5M#}")),t.report("客户端没有返回data")})}else Object(n["MessageBox"])({type:"",message:t.$$t("{#请为火币开放相机权限：手机设置->隐私->相机->火币（打开)，以便于您正常使用。#}"),title:t.$$t("{#提示#}"),showCancelButton:!1,showClose:!1,confirmButtonText:t.$$t("{#知道了#}"),callback:()=>{window.sensors.track("h5_kyc_self_no_camera"),window.history.go(-1)}})},checkPermission(){const t=this,s=Object(C["a"])();c()("00000000",({data:e})=>{e&&e.permissions&&!e.permissions.camera&&"iOS"===s&&(t.isCamera=!1)})},async uploadPic(t){const s=this;try{await Object(k["a"])(t),s.showLoading(!1);const e={fileExtensionName:"."+t.type.split("/")[1],fileType:s.positive?1:2},{success:i,message:a,data:o}=await Object(A["q"])(e);if(i){const e=new Date;console.log("upload url",o.url),Object(A["x"])(o.url,t).then(()=>{console.log("upload url","success");const t=new Date;window.sensors.track("h5_kyc_self_upload_time",{time:t-e,desc:"毫秒"}),s.checkImg(o.fileKey)}).catch(t=>{s.showToast(t),s.report("上传s3失败")})}else s.showToast(a)}catch(e){s.showToast(e),s.report(e),s.$refs.fileBtn&&(s.$refs.fileBtn.value="")}},report(t){window&&window.sensors&&window.sensors.track("h5_kyc_self_img_error",{desc:t}),woodpecker&&woodpecker.metrics&&woodpecker.metrics.gauge("kyc_img_upload",1,t)},async checkImg(t){const s=this,{success:e,data:i}=await Object(A["g"])({fileKey:t});e&&i?(s.showLoading(!0),s.imgSrc=i,s.$emit("saveFile",{positive:s.positive,fileKey:t})):(s.showToast(s.$$t("{#上传失败#}")),s.report("上传s3失败"))}}},b=y,$=(e("a156"),Object(h["a"])(b,f,m,!1,null,"2da264b6",null)),B=$.exports,S=e("1549"),T={data(){return{cardType:"",cardName:{1:this.$$t("{#身份证#}"),2:this.$$t("{#护照#}"),3:this.$$t("{#驾照#}")},positive:{},obverse:{},authBizCode:"",lang:"",authIng:!1,isLoading:!0}},components:{Header:r["a"],Example:_,Upload:B,Btn:S["a"]},created(){window.sensors.track("h5_kyc_self_photo_expose"),this.cardType=Object(w["h"])("cardType"),this.authBizCode=this.$store.state.stageData.authBizCode,this.lang=v["a"].get("lang")||"en-us"},computed:{canSubmit(){return 2===this.cardType||"2"===this.cardType?!(!this.positive[this.cardType]||!this.isLoading):!!(this.positive[this.cardType]&&this.isLoading&&this.obverse[this.cardType])}},methods:{goBack(){window.history.go(-1)},saveFile(t){t.positive?this.$set(this.positive,this.cardType,t.fileKey):this.$set(this.obverse,this.cardType,t.fileKey)},showLoading(t){this.isLoading=t},async goVerificate(){const t=this,{cardType:s,canSubmit:e,authBizCode:i,authIng:a}=t;if(!e||a)return;t.authIng=!0,window.sensors.track("h5_kyc_self_submit_click");const o=Object(w["h"])("syncDigital")||0,c=Object(w["h"])("nationality"),r=Object(w["h"])("modify"),l={cardType:s,authStep:"C1",authItem:1===+o||1===+r?"C1_SELF_V2":"C1_SELF",authBizCode:i},{success:d,message:p,code:u,data:h}=await Object(A["p"])(l);d&&200===u?Object(A["d"])({cardType:s,positive:t.positive[s],obverse:t.obverse[s],ticket:h.ticket,nationality:c,syncDigital:o}).then(s=>{200===s.code?n["Message"].success({duration:2e3,offset:52,customClass:"is-success",message:t.$$t("{#提交成功#}"),onClose(){t.$pushState("/mkyc/c1-result")}}):(t.showToast(s.message),woodpecker&&woodpecker.metrics.gauge("kyc_c1_submit",1,"c1接口返回错误信息"))}).catch(()=>{woodpecker&&woodpecker.metrics.gauge("kyc_c1_submit",1,"c1提交接口报错")}):201017===u||203001===u?Object(n["MessageBox"])({type:"",message:t.$$t("{#认证过于频繁，请稍后再试，或进行人工审核#}"),title:t.$$t("{#认证次数过多#}"),showCancelButton:!1,showClose:!0,closeOnClickModal:!1,confirmButtonText:t.$$t("{#人工审核#}"),callback:e=>{"confirm"===e?t.manualAuditFun({cardType:s,positive:t.positive[s],obverse:t.obverse[s]}):t.goAuth()}}):t.showToast(p)},manualAuditFun(t){const s=this;Object(A["t"])(t).then(t=>{200===t.code?n["Message"].success({duration:2e3,offset:52,customClass:"is-success",message:s.$$t("{#提交成功#}"),onClose(){s.goAuth()}}):s.showToast(t.message)})},showToast(t){const s=this;n["Message"].error({duration:2e3,offset:52,customClass:"is-error",message:t,onClose(){s.authIng=!1}})},goAuth(){c()("20010006",()=>{})}}},j=T,O=(e("d47e"),Object(h["a"])(j,i,a,!1,null,"1982ae78",null));s["default"]=O.exports},b893:function(t,s,e){"use strict";e.d(s,"a",(function(){return i}));e("cec8"),e("07a7");const i=()=>{const t=navigator.userAgent,s=t.toLowerCase();let e="";return e=/iphone|ipad|ipod/.test(s)?"iOS":/android/.test(s)?"android":"pc",e}},d47e:function(t,s,e){"use strict";e("4550")},e669:function(t,s){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAIHSURBVHgB5ZsxTsNAEEVnY0AisogipUiFOIrpuFVMx1UouQF0lHCDQEUkCkcKIREg44nkIOQ43rV3ZzOzr6Chek8pLO2fCDwyGl9M+vFZslzMH8ATEXgC5QHyFEAl/XgAviJ4CfAnX+IvAnmAqnyJnwikAerlS+gjkAVoli9RyWk8mH4u5s9AwBEQoC9fkMPTz7p3B0QocIyp/PdaXWbZNAMinAY4dHnEWQAO8oiTAFzkEesBOMkjVgNwk0esBeAoj1gJwFUe6RyAszzSKQB3eaR1AAnySKsAUuQR4wCS5BGjANLkEe0AEuURrQBS5ZHGAJLlkb0BpMsjtQFCkEd2BghFHqkECEke+RfASF4I2wAhyiObAKHKIypkeaQHBI8jh0y0XGT3/XiIERIIkM3jaMgRtq/DAUbI8c+uD6G0+N8ENFDFh9AX8w+hyj7A6JegYBxFcHVyPLxdrbIVMGTnQCKkCLULkVAi7J3IhBChcSMkPYLWSEpyBO2VmNQIRjM5iRGMd4LSIrQaSkqK0HopKiVCp6mshAidt8LcI1gZS3OOYG0tzjWC1bk8xwjW7wW4RXByMMEpgrOLES4RnJ7McIjg/Gbo0COQHE2ZRuhFarb8yB6BALKrMf0I+fX77OUGiCC9G2yOUMi/vaZACPnlaH0EennEy+1wNYIfee/gM9xofJ6CR34BVW0JeIvm+VsAAAAASUVORK5CYII="},e931:function(t,s,e){"use strict";e("f46e")},f46e:function(t,s,e){}}]);